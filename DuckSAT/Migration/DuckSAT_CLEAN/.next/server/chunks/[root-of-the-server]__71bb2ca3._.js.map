{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 154, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/lionv/DuckSAT/DuckSAT_CLEAN/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n  prisma: PrismaClient | undefined\r\n}\r\n\r\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient()\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\r\n"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6HAAA,CAAA,eAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG","debugId":null}},
    {"offset": {"line": 166, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/lionv/DuckSAT/DuckSAT_CLEAN/src/lib/auth.ts"],"sourcesContent":["import GoogleProvider from 'next-auth/providers/google'\r\nimport { PrismaAdapter } from '@auth/prisma-adapter'\r\nimport { prisma } from './prisma'\r\n\r\n// Check if we're running in a server environment (not in the browser)\r\n// This prevents validation code from running in client-side bundles\r\nconst isServer = typeof window === 'undefined';\r\n\r\n// Only validate environment variables on the server side\r\n// This prevents errors in client-side bundles where env vars are not available\r\nif (isServer) {\r\n  const isProduction = process.env.NODE_ENV === 'production';\r\n  const secret = process.env.NEXTAUTH_SECRET;\r\n  const nextAuthUrl = process.env.NEXTAUTH_URL;\r\n\r\n  // Debug logging to help diagnose environment variable loading issues\r\n  // Logs in two scenarios:\r\n  // 1. Development mode (always logs to help developers)\r\n  // 2. Production mode when secret or URL is missing (to help diagnose deployment issues)\r\n  // The actual secret value is never logged for security\r\n  if (!isProduction || !secret || !nextAuthUrl) {\r\n    console.log('[NextAuth Config] Environment check:', {\r\n      NODE_ENV: process.env.NODE_ENV,\r\n      NEXTAUTH_SECRET_present: !!secret,\r\n      NEXTAUTH_SECRET_length: secret?.length || 0,\r\n      NEXTAUTH_URL_present: !!nextAuthUrl,\r\n      NEXTAUTH_URL_length: nextAuthUrl?.length || 0,\r\n    });\r\n  }\r\n\r\n  // Fail-fast in production if NEXTAUTH_SECRET is not set\r\n  if (isProduction && !secret) {\r\n    const errorMessage = `NEXTAUTH_SECRET environment variable must be set in production.\r\nGenerate a secure secret with: openssl rand -base64 32\r\nFor Vercel deployments, ensure the variable is set in the Vercel dashboard under Project Settings > Environment Variables.\r\n⚠️ IMPORTANT: Variables must be set in the Vercel UI (Dashboard → Settings → Environment Variables), not just in .env files or build scripts.`;\r\n    \r\n    console.error('[NextAuth Config] FATAL:', errorMessage);\r\n    throw new Error(errorMessage);\r\n  }\r\n\r\n  // Fail-fast in production if NEXTAUTH_URL is not set\r\n  if (isProduction && !nextAuthUrl) {\r\n    const errorMessage = `NEXTAUTH_URL environment variable must be set in production.\r\nSet this to your application's canonical URL (e.g., https://yourdomain.vercel.app).\r\nFor Vercel deployments, ensure the variable is set in the Vercel dashboard under Project Settings > Environment Variables.\r\n⚠️ IMPORTANT: Variables must be set in the Vercel UI (Dashboard → Settings → Environment Variables), not just in .env files or build scripts.`;\r\n    \r\n    console.error('[NextAuth Config] FATAL:', errorMessage);\r\n    throw new Error(errorMessage);\r\n  }\r\n}\r\n\r\n// Helper to build providers list\r\nfunction getProviders() {\r\n  // If running in the browser, return empty array (should never be used)\r\n  // This prevents errors if the module is accidentally bundled into client code\r\n  if (!isServer) {\r\n    console.warn('[NextAuth Config] getProviders() called in browser context. This should not happen in normal operation.');\r\n    return [];\r\n  }\r\n  \r\n  const providers = [];\r\n  // Only configure Google provider if credentials are available\r\n  if (process.env.GOOGLE_CLIENT_ID && process.env.GOOGLE_CLIENT_SECRET) {\r\n    providers.push(\r\n      GoogleProvider({\r\n        clientId: process.env.GOOGLE_CLIENT_ID,\r\n        clientSecret: process.env.GOOGLE_CLIENT_SECRET,\r\n      })\r\n    );\r\n  }\r\n  return providers;\r\n}\r\n\r\n// Helper to get NextAuth secret - no fallback in production\r\nfunction getSecret() {\r\n  // If running in the browser, return a placeholder (should never be used)\r\n  // This prevents errors if the module is accidentally bundled into client code\r\n  if (!isServer) {\r\n    console.warn('[NextAuth Config] getSecret() called in browser context. This should not happen in normal operation.');\r\n    return 'client-side-placeholder-not-for-use';\r\n  }\r\n  \r\n  const secret = process.env.NEXTAUTH_SECRET;\r\n  const isProduction = process.env.NODE_ENV === 'production';\r\n  \r\n  // In production, secret must be set (validated server-side at module load)\r\n  if (secret) {\r\n    return secret;\r\n  }\r\n  \r\n  // Only use fallback in development\r\n  if (!isProduction) {\r\n    return 'development-secret-please-change-in-production';\r\n  }\r\n  \r\n  // This should never be reached due to module-load validation above,\r\n  // but included as a safety measure\r\n  throw new Error(`NEXTAUTH_SECRET environment variable must be set in production.\r\nGenerate a secure secret with: openssl rand -base64 32`);\r\n}\r\n\r\nexport const authOptions = {\r\n  adapter: PrismaAdapter(prisma),\r\n  providers: getProviders(),\r\n  session: {\r\n    strategy: 'database' as const,\r\n  },\r\n  pages: {\r\n    signIn: '/auth/signin',\r\n    error: '/auth/error',\r\n  },\r\n  callbacks: {\r\n    async session({ session, user }: any) {\r\n      if (session?.user) {\r\n        session.user.id = user.id\r\n      }\r\n      return session\r\n    },\r\n  },\r\n  secret: getSecret(),\r\n  debug: process.env.NODE_ENV === 'development',\r\n}\r\n\r\nexport { getProviders, getSecret }\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;AAEA,sEAAsE;AACtE,oEAAoE;AACpE,MAAM,WAAW,gBAAkB;AAEnC,yDAAyD;AACzD,+EAA+E;AAC/E,wCAAc;IACZ,MAAM,eAAe,oDAAyB;IAC9C,MAAM,SAAS,QAAQ,GAAG,CAAC,eAAe;IAC1C,MAAM,cAAc,QAAQ,GAAG,CAAC,YAAY;IAE5C,qEAAqE;IACrE,yBAAyB;IACzB,uDAAuD;IACvD,wFAAwF;IACxF,uDAAuD;IACvD,wCAA8C;QAC5C,QAAQ,GAAG,CAAC,wCAAwC;YAClD,QAAQ;YACR,yBAAyB,CAAC,CAAC;YAC3B,wBAAwB,QAAQ,UAAU;YAC1C,sBAAsB,CAAC,CAAC;YACxB,qBAAqB,aAAa,UAAU;QAC9C;IACF;IAEA,wDAAwD;IACxD;;IAUA,qDAAqD;IACrD;;AASF;AAEA,iCAAiC;AACjC,SAAS;IACP,uEAAuE;IACvE,8EAA8E;IAC9E;;IAKA,MAAM,YAAY,EAAE;IACpB,8DAA8D;IAC9D,IAAI,QAAQ,GAAG,CAAC,gBAAgB,IAAI,QAAQ,GAAG,CAAC,oBAAoB,EAAE;QACpE,UAAU,IAAI,CACZ,CAAA,GAAA,qJAAA,CAAA,UAAc,AAAD,EAAE;YACb,UAAU,QAAQ,GAAG,CAAC,gBAAgB;YACtC,cAAc,QAAQ,GAAG,CAAC,oBAAoB;QAChD;IAEJ;IACA,OAAO;AACT;AAEA,4DAA4D;AAC5D,SAAS;IACP,yEAAyE;IACzE,8EAA8E;IAC9E;;IAKA,MAAM,SAAS,QAAQ,GAAG,CAAC,eAAe;IAC1C,MAAM,eAAe,oDAAyB;IAE9C,2EAA2E;IAC3E,IAAI,QAAQ;QACV,OAAO;IACT;IAEA,mCAAmC;IACnC,wCAAmB;QACjB,OAAO;IACT;;;AAMF;AAEO,MAAM,cAAc;IACzB,SAAS,CAAA,GAAA,sJAAA,CAAA,gBAAa,AAAD,EAAE,sHAAA,CAAA,SAAM;IAC7B,WAAW;IACX,SAAS;QACP,UAAU;IACZ;IACA,OAAO;QACL,QAAQ;QACR,OAAO;IACT;IACA,WAAW;QACT,MAAM,SAAQ,EAAE,OAAO,EAAE,IAAI,EAAO;YAClC,IAAI,SAAS,MAAM;gBACjB,QAAQ,IAAI,CAAC,EAAE,GAAG,KAAK,EAAE;YAC3B;YACA,OAAO;QACT;IACF;IACA,QAAQ;IACR,OAAO,oDAAyB;AAClC","debugId":null}},
    {"offset": {"line": 268, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/lionv/DuckSAT/DuckSAT_CLEAN/src/app/api/progress/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { getServerSession } from 'next-auth/next'\r\nimport { authOptions } from '@/lib/auth'\r\nimport { prisma } from '@/lib/prisma'\r\n\r\ninterface QuestionResult {\r\n  category?: string\r\n  moduleType?: string\r\n  isCorrect: boolean\r\n}\r\n\r\ninterface TestResult {\r\n  questionResults: QuestionResult[]\r\n  score: number\r\n  createdAt: Date\r\n}\r\n\r\nexport async function GET(_request: NextRequest) {\r\n  try {\r\n    const session = await getServerSession(authOptions)\r\n    \r\n    if (!session?.user?.email) {\r\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n    }\r\n\r\n    // Get user\r\n    const user = await prisma.user.findUnique({\r\n      where: { email: session.user.email }\r\n    })\r\n\r\n    if (!user) {\r\n      return NextResponse.json({ error: 'User not found' }, { status: 404 })\r\n    }\r\n\r\n    // Get test results\r\n    const testResults = await prisma.testResult.findMany({\r\n      where: { userId: user.id },\r\n      include: {\r\n        questionResults: true\r\n      },\r\n      orderBy: { completedAt: 'desc' }\r\n    })\r\n\r\n    // Calculate analytics\r\n    const testsCompleted = testResults.length\r\n    const scores = testResults.map(result => result.score)\r\n    const averageScore = scores.length > 0 ? Math.round(scores.reduce((a, b) => a + b, 0) / scores.length) : 0\r\n    \r\n    // Calculate time spent (in minutes)\r\n    const totalTimeSpent = testResults.reduce((total, result) => {\r\n      return total + (result.totalTimeSpent || 0)\r\n    }, 0)\r\n\r\n    // Get category performance\r\n    const categoryStats: Record<string, { correct: number, total: number }> = {}\r\n    \r\n    testResults.forEach(result => {\r\n      result.questionResults.forEach((qr: QuestionResult) => {\r\n        const category = qr.category || 'Unknown'\r\n        if (!categoryStats[category]) {\r\n          categoryStats[category] = { correct: 0, total: 0 }\r\n        }\r\n        categoryStats[category].total++\r\n        if (qr.isCorrect) {\r\n          categoryStats[category].correct++\r\n        }\r\n      })\r\n    })\r\n\r\n    // Determine strong and weak areas\r\n    const categoryPerformance = Object.entries(categoryStats).map(([category, stats]) => ({\r\n      category,\r\n      percentage: stats.total > 0 ? Math.round((stats.correct / stats.total) * 100) : 0,\r\n      correct: stats.correct,\r\n      total: stats.total\r\n    })).filter(item => item.total >= 3) // Only include categories with at least 3 questions\r\n\r\n    const strongAreas = categoryPerformance\r\n      .filter(item => item.percentage >= 75)\r\n      .sort((a, b) => b.percentage - a.percentage)\r\n      .slice(0, 3)\r\n      .map(item => item.category)\r\n\r\n    const weakAreas = categoryPerformance\r\n      .filter(item => item.percentage < 60)\r\n      .sort((a, b) => a.percentage - b.percentage)\r\n      .slice(0, 3)\r\n      .map(item => item.category)\r\n\r\n    // Recent test scores (last 5)\r\n    const recentScores = scores.slice(0, 5)\r\n\r\n    // Module performance\r\n    const moduleStats: Record<string, { correct: number, total: number }> = {}\r\n    testResults.forEach(result => {\r\n      result.questionResults.forEach((qr: QuestionResult) => {\r\n        const moduleType = qr.moduleType || 'Unknown'\r\n        if (!moduleStats[moduleType]) {\r\n          moduleStats[moduleType] = { correct: 0, total: 0 }\r\n        }\r\n        moduleStats[moduleType].total++\r\n        if (qr.isCorrect) {\r\n          moduleStats[moduleType].correct++\r\n        }\r\n      })\r\n    })\r\n\r\n    const modulePerformance = Object.entries(moduleStats).map(([moduleType, stats]) => ({\r\n      module: moduleType,\r\n      percentage: stats.total > 0 ? Math.round((stats.correct / stats.total) * 100) : 0,\r\n      correct: stats.correct,\r\n      total: stats.total\r\n    }))\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        testsCompleted,\r\n        averageScore,\r\n        strongAreas,\r\n        weakAreas,\r\n        recentScores,\r\n        timeSpent: Math.round(totalTimeSpent / 60), // Convert to minutes\r\n        categoryPerformance,\r\n        modulePerformance,\r\n        testHistory: testResults.map(result => ({\r\n          id: result.id,\r\n          score: result.score,\r\n          completedAt: result.completedAt,\r\n          timeSpent: result.totalTimeSpent\r\n        }))\r\n      }\r\n    })\r\n\r\n  } catch (error: unknown) {\r\n    console.error('Progress API Error:', error)\r\n    return NextResponse.json({ \r\n      error: 'Failed to fetch progress data' \r\n    }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}